(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8307:function(e,t,o){Promise.resolve().then(o.bind(o,2480)),Promise.resolve().then(o.t.bind(o,2506,23))},2480:function(e,t,o){"use strict";o.d(t,{default:function(){return Z}});var s=o(7437),r=o(9449),n=o.n(r),l=o(7776),a=o(7585),i=o(2265),c=o(6547),u=o(6862),d=o(7954);let m=e=>{let{viewport:t,set:o}=(0,u.D)(),{width:r,height:n}=t,l=(0,i.useRef)(null);return(0,s.jsx)(d.c,{makeDefault:!0,ref:l,position:[e.t[0],e.t[1],e.t[2]],near:.01,far:100,fov:70,aspect:n/r})},j=()=>{let{scene:e}=(0,u.D)();return e.background=new l.Color(7895160),e.fog=new l.Fog(.787878,50,60),(0,s.jsxs)("mesh",{receiveShadow:!0,children:[(0,s.jsx)("planeGeometry",{args:[200,200]}),(0,s.jsx)("meshPhongMaterial",{color:4934475,specular:new l.Color(1052688)})]})},h=e=>{let t=(0,i.useRef)(null);return(0,s.jsx)("directionalLight",{ref:t,color:e.color,intensity:e.intensity,position:[e.x,e.y,e.z],castShadow:!0})};var p=o(6080),b=o(2325),f=o(2618),g=o(1957),x=o(7413),y=o(2851);let v=(e,t,o)=>{e.isMesh?(Array.isArray(e.material)?e.material.forEach(e=>{e=e.clone()}):e.material=e.material.clone(),o&&(e.castShadow=!0,e.receiveShadow=!0),1!==t&&(e.material.isMaterial?(e.material.transparent=!0,e.material.opacity=t):Array.isArray(e.material)&&e.material.forEach(e=>{e.transparent=!0,e.opacity=t}))):"PointLight"===e.type?e.visible=!1:(e.isObject3D||e.isGroup)&&e.children.forEach(e=>{v(e,t,o)})},w=e=>{let t=(0,u.H)(x.j,e.url),o=(0,i.useMemo)(()=>t.clone(),[t]);return(0,s.jsxs)("mesh",{position:[e.t[0],e.t[1],e.t[2]],quaternion:[e.q[0],e.q[1],e.q[2],e.q[3]],scale:[e.scale[0],e.scale[1],e.scale[2]],castShadow:!0,receiveShadow:!0,name:"loaded",children:[(0,s.jsx)("primitive",{object:o,attach:"geometry"}),(0,s.jsx)("meshStandardMaterial",{color:e.color?e.color:"hotpink"})]})},E=e=>(0,s.jsx)(i.Fragment,{children:(0,s.jsx)(g.h,{src:e.url,position:[e.t[0],e.t[1],e.t[2]],scale:[e.scale[0],e.scale[1],e.scale[2]],rotation:[e.euler[0],e.euler[1],e.euler[2]],onClick:()=>{console.log(e.id)}})}),O=e=>{let t=(0,u.H)(y.G,e.url),o=(0,i.useMemo)(()=>t.scene.clone(!0),[t.scene]);return(0,i.useEffect)(()=>{o.children.forEach(t=>{v(t,e.opacity,!0)}),o.name="loaded"},[o,e.opacity]),(0,s.jsx)("primitive",{object:o,position:e.t,scale:e.scale,quaternion:e.q})};var S=e=>{if(null===e.filename)return console.log("LOADER: filename is undefined, cannot proceed..."),(0,s.jsx)(s.Fragment,{});{let t=e.filename.split(".").pop(),o=e.filename;switch(o="/retrieve/"+o,null==t?void 0:t.toLowerCase()){case"stl":return(0,s.jsx)(w,{url:o,...e});case"splat":return(0,s.jsx)(E,{url:o,...e});case"ply":return console.log("LOADING PLY FILE HERE"),(0,s.jsx)(E,{url:o,...e});default:return(0,s.jsx)(O,{url:o,...e})}}};let C=e=>{let[t,o]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{o(!0)},[]),(0,s.jsx)(i.Fragment,{children:t&&(0,s.jsx)(i.Suspense,{fallback:(0,s.jsx)(function(){let{progress:e}=(0,p.S)();return(0,s.jsxs)(b.V,{center:!0,children:[Math.round(e)," % loaded"]})},{}),children:(0,s.jsx)(S,{...e})})})},D=e=>{let t=(0,i.useRef)(null);return(0,s.jsx)("mesh",{ref:t,position:e.t?[e.t[0],e.t[1],e.t[2]]:[0,0,0],quaternion:e.q?[e.q[0],e.q[1],e.q[2],e.q[3]]:[0,0,0,1],name:"loaded",children:(0,s.jsx)("axesHelper",{args:[e.length?e.length:.1]})})},_=e=>{let t=(0,i.useRef)(null);switch((0,i.useEffect)(()=>{"cylinder"===e.stype&&t.current.rotateX(Math.PI/2)},[e.stype]),e.stype){case"box":default:return(0,s.jsx)("boxGeometry",{args:e.scale?[e.scale[0],e.scale[1],e.scale[2]]:[1,1,1]});case"sphere":return(0,s.jsx)("sphereGeometry",{args:[e.radius,64,64]});case"cylinder":return(0,s.jsx)("cylinderGeometry",{ref:t,args:[e.radius,e.radius,e.length,32]})}},T=e=>{let t=(0,i.useRef)(null);return(0,i.useEffect)(()=>{t.current&&t.current}),(0,s.jsx)(f.Y,{ref:t,position:e.t?[e.t[0],e.t[1],e.t[2]]:[0,0,0],quaternion:e.q?[e.q[0],e.q[1],e.q[2],e.q[3]]:[0,0,0,1],castShadow:!0,name:"loaded",showX:!1,showY:!1,showZ:!1,onClick:()=>{t.current&&t.current},children:(0,s.jsxs)("mesh",{children:[(0,s.jsx)(_,{...e}),(0,s.jsx)("meshStandardMaterial",{transparent:!!e.opacity,color:e.color?e.color:"hotpink",opacity:e.opacity?e.opacity:1})]})})},I=e=>{if(!1==e.display)return(0,s.jsx)(i.Fragment,{});switch(e.stype){case"mesh":case"splat":return(0,s.jsx)(C,{...e});case"axes":return(0,s.jsx)(D,{...e});default:return(0,s.jsx)(T,{...e})}},k=e=>(0,s.jsx)("group",{children:e.meshes.map((e,t)=>(0,s.jsx)(I,{...e},t))}),R=i.forwardRef((e,t)=>(0,s.jsx)("group",{ref:t,children:e.meshes.map((e,t)=>(0,s.jsx)(k,{meshes:e},t))}));R.displayName="GroupCollection";var N=o(9079),q=o(8832),L=o.n(q);o(605);var V=o(3407),A=o(2844);let P={objects:[],objectList:{NONE:-1},noObjects:0,compID:0,targetID:0,treeVisible:!1,tree_nodes:[{id:"NONE",data:{label:"NO DATA"},position:{x:0,y:0},is_active:0}],tree_edges:[{}]},B=(0,V.Ue)((0,A.n)(e=>({...P,setObjectVisibility:t=>e(e=>{e.objects[e.targetID]&&e.objects[e.targetID].map(e=>{e.display=t})}),setObjectVisibilityKey:(t,o)=>e(e=>{e.objects[t]&&e.objects[t].map(e=>{e.display=o})}),toggleTreeVisibility:()=>e(e=>{e.treeVisible=!e.treeVisible}),setTargetID:t=>e(e=>{e.targetID=t}),addObject:(t,o)=>e(e=>{e.noObjects>0?e.objects=[...e.objects,t]:e.objects=[t],e.objectList[o]=e.noObjects,e.noObjects+=1}),removeObject:t=>e(e=>{if(e.objects&&e.objects.length&&e.noObjects>0&&t>=0){let o=Object.keys(e.objectList).find(o=>e.objectList[o]===Number(t));console.log("Object key is "+o);let{[o]:s,...r}=e.objectList;Object.keys(r).forEach(function(e){r[e]>t&&(console.log("Value "+r[e]+" is greater than removed "+t),r[e]-=1)}),e.objectList=r,e.noObjects-=1,1===e.objects.length?e.objects=[]:e.objects.splice(t,1)}else console.log("Undefined - Cannot Remove"),alert("Cannot Remove Object -> Object is Invalid or Empty")}),setPos:t=>e(e=>{console.log("targetID: "+e.targetID),e.objects[e.targetID]&&(e.objects[e.targetID][e.compID].t=[t.x,t.y,t.z])}),setObjectPos:(t,o,s)=>e(e=>{console.log("setting pos "+t+" for id "+o+" with comp "+s),e.objects[o]&&(console.log("OBJECT VALID for POS"),e.objects[o][s].t=t)}),setRot:t=>e(e=>{if(e.objects[e.targetID]){var o=new l.Euler(t.x,t.y,t.z),s=new l.Quaternion().setFromEuler(o);e.objects[e.targetID][e.compID].euler=[t.x,t.y,t.z],e.objects[e.targetID][e.compID].q=[s.x,s.y,s.z,s.w]}}),setObjectRot:(t,o,s)=>e(e=>{e.objects[o]&&(console.log("OBJECT VALID for ROT"),e.objects[o][s].q=t)}),setColour:t=>e(e=>{e.objects[e.targetID]&&(e.objects[e.targetID][e.compID].color=t)}),setTreeData:t=>e(e=>{console.log("Running Tree Update"),e.tree_nodes=t.nodes,e.tree_edges=t.connections})}))),K=(e,t,o)=>{let s=new(L()).graphlib.Graph().setDefaultEdgeLabel(()=>({}));return s.setGraph({rankdir:o.direction}),t.forEach(e=>s.setEdge(e.source,e.target)),e.forEach(e=>{var t,o,r,n;return s.setNode(e.id,{...e,width:null!==(r=null===(t=e.measured)||void 0===t?void 0:t.width)&&void 0!==r?r:0,height:null!==(n=null===(o=e.measured)||void 0===o?void 0:o.height)&&void 0!==n?n:0})}),L().layout(s),{nodes:e.map(e=>{var t,o,r,n;let l=s.node(e.id),a=l.x-(null!==(r=null===(t=e.measured)||void 0===t?void 0:t.width)&&void 0!==r?r:0)/2,i=l.y-(null!==(n=null===(o=e.measured)||void 0===o?void 0:o.height)&&void 0!==n?n:0)/2;return{...e,position:{x:a,y:i}}}),edges:t}},G=()=>{let{fitView:e}=(0,N._K)(),t=B(e=>e.treeVisible),o=B(e=>e.tree_nodes),r=B(e=>e.tree_edges),n=(0,i.useCallback)(t=>{K(o,r,{direction:t}),window.requestAnimationFrame(()=>{e()})},[o,r,t]);return(0,s.jsx)("div",{style:{height:400},children:(0,s.jsx)(N.x$,{nodes:o,edges:r,defaultEdgeOptions:{animated:!0,style:{stroke:"white"}},style:{backgroundColor:"#D3D2E5"},fitView:!0,connectionLineStyle:{stroke:"white"},onInit:()=>n("TB"),children:(0,s.jsxs)(N.s_,{position:"bottom-left",children:[(0,s.jsx)("button",{onClick:()=>n("TB"),children:" Vertical "}),(0,s.jsx)("button",{onClick:()=>n("LR"),children:" Horizontal "})]})})})};function z(){return(0,s.jsx)(N.tV,{children:(0,s.jsx)(G,{})})}let F=new(o(6731)).EventEmitter;var M=(e,t)=>{switch(console.log("action: ",t,"state ",e),t.type){case"newElement":return{...e,formElements:[...e.formElements,t.data]};case"userInputState":let o={...e.formData},s=[...e.formElements];return o[t.index]=t.data,s[t.index-3][t.valueName]=t.value,{formElements:s,formData:o};case"userInputNoState":let r={...e.formData};return r[t.index]=t.data,{formElements:[...e.formElements],formData:r};case"wsUpdate":let n=[...e.formElements];return n[t.index-3]=t.data,{...e,formElements:n};case"reset":let l={...e.formData};return t.indices.map(e=>{delete l[e]}),{formData:l,formElements:[...e.formElements]};default:throw Error()}},W=o(8592),H=function(){return(0,s.jsx)(W.G,{})};function U(e){let{isOpen:t,onClose:o,children:r,setCloseButton:n}=e;return(0,s.jsx)(s.Fragment,{children:t?(0,s.jsxs)("div",{className:"overlay",children:[(0,s.jsx)("div",{className:"overlay_background",onClick:o}),(0,s.jsxs)("div",{className:"overlay_container",children:[n?(0,s.jsx)("div",{className:"overlay_controls",children:(0,s.jsx)("button",{className:"overlay_close_button",type:"button",onClick:o})}):null,r]})]}):null})}o(1472);var J=o(8154),Y=function(){let e=B(e=>e.objects),t=B(e=>e.targetID),o=B(e=>e.compID),r=B(e=>e.noObjects),n=B(e=>e.setObjectVisibility),l=B(e=>e.setTargetID),a=B(e=>e.setPos),c=B(e=>e.setRot),u=B(e=>e.addObject),d=B(e=>e.removeObject),m=B(e=>e.setColour),j=B(e=>e.objectList),h=B(e=>e.toggleTreeVisibility),p=B(e=>e.treeVisible),[b,f]=(0,i.useState)("cylinder"),[g,x]=(0,i.useState)("#f00"),[y,v]=(0,i.useState)("0"),[w,E]=(0,J.M4)("Object Handler",()=>({ID:{label:"ID:",options:j,onChange:e=>{l(e)}},Visible:{label:"Visible:",value:!0,onChange:e=>n(e)},Position:{label:"Position:",value:{x:0,y:0,z:0},onChange:e=>a(e)},Rotation:{label:"Rotation:",value:{x:0,y:0,z:0},onChange:e=>c(e)},Colour:{value:"#f00",onChange:e=>m(e)},NoObjects:{label:"Total:",value:r},"Remove Object":(0,J.LI)(()=>{d(t)})}),[t,r]);return(0,i.useEffect)(()=>{E({NoObjects:r}),e[t]&&(E({Visible:e[t][o].display}),E({Position:e[t][o].t}),E({Rotation:e[t][o].euler}),E({Colour:e[t][o].color}))},[r,t,e,E,o]),(0,J.M4)("Object Creator",()=>({Type:{options:["cylinder","sphere","cube"],onChange:e=>{f(e)}},Colour:{value:"#0f0",onChange:e=>{x(e)}},Key:{value:"obj_001",onChange:e=>{v(e)}},"Add Object":(0,J.LI)(()=>{y in j?alert("Cannot Create Object -> Key Already in Use"):u([{stype:b,scale:[1,1,1],filename:void 0,radius:.5,length:1,euler:[0,0,0],q:[0,0,0,1],t:[0,0,0],v:[0,0,0],color:g,opacity:0,display:!0,head_length:0,head_radius:0}],y)})}),[r,b,y]),(0,J.M4)("Behaviour Tree Handler",()=>({[p?"Close Tree Viewer":"Open Tree Viewer"]:(0,J.LI)(()=>{h()})}),[p]),(0,s.jsx)(s.Fragment,{})};let X=e=>{(0,i.useRef)(null);let t=(0,i.useRef)(),[o,r]=(0,i.useState)(!1),[u,d]=(0,i.useState)(0),[p,b]=(0,i.useState)(!1),[f,g]=(0,i.useState)(!1),[x,y]=(0,i.useReducer)(M,{formData:{},formElements:[]}),v=B(e=>e.addObject),w=B(e=>e.removeObject),E=B(e=>e.objects),O=B(e=>e.objectList),S=B(e=>e.treeVisible),C=B(e=>e.setObjectPos),D=B(e=>e.setObjectRot),_=B(e=>e.setObjectVisibilityKey),T=B(e=>e.setTreeData);return(0,i.useEffect)(()=>{let o=!0;g(!0);let s=e.port,r=window.location.search.substring(1).split("&");if(0===s&&(console.log("WEBSOCKET: port is 0, using server_params..."),s=parseInt(r[0])),null===s||isNaN(s))console.log("WEBSOCKET: port is null or NaN, cannot establish socket"),o=!1;else{let e="ws://localhost:"+s+"/";t.current=new WebSocket(e),o&&(t.current.onopen=()=>{t.current.onclose=()=>{console.log("WEBSOCKET: closed by Swift"),setTimeout(()=>{window.close()},5e3)},t.current.send("Connected"),b(!0)},F.on("wsSwiftTx",e=>{console.log("WEBSOCKET: sending back: "+e),t.current.send(e)})),t&&(t.current.onmessage=e=>{let t=JSON.parse(e.data),o=t[0],s=t[1];console.log("Received function: "+o+" with data: "+s),F.emit("wsRx",o,s)})}},[e.port]),(0,i.useEffect)(()=>{let e={shape:e=>{let t=E.length.toString();console.log("WEBSOCKET: requested shape function. ID: "+t),console.log("WEBSOCKET: data: "),console.log(e),e&&e[0].uuid?v(e,e[0].uuid):v(e,t),F.emit("wsSwiftTx",t)},shape_mounted:e=>{let t=e[0],o=e[1];console.log("WEBSOCKET: requested shape mounted function. ID: "+t);try{o==o?F.emit("wsSwiftTx","1"):F.emit("wsSwiftTx","0")}catch(e){console.log(e),F.emit("wsSwiftTx","0")}},remove:e=>{console.log("WEBSOCKET: removing id "+e),w(e),F.emit("wsSwiftTx","0")},shape_poses:e=>{F.emit("wsSwiftTx","[]"),e.forEach(e=>{let t=e[0],o=e[1];console.log("shape poses id "+t),console.log("shape poses group "),console.log(JSON.stringify(o));let s=O[t];console.log("shape poses index for lookup: "+s),o.forEach((e,t)=>{C(e.t,s,t),D(e.q,s,t)})})},shape_visible:e=>{console.log("SHAPE VISIBILITY START");let t=e[0],o=e[1];console.log("shape visibility id "+t+" setting visible: "+o),_(O[t],o),F.emit("wsSwiftTx","[]")},tree_update:e=>{console.log("TREE DATA UPDATE");let t=e[0];console.log(JSON.stringify(t)),T(t),F.emit("wsSwiftTx","0")},sim_time:e=>{d(parseFloat(e))},close:()=>{t.current.close()}};F.removeAllListeners("wsRx"),F.on("wsRx",(t,o)=>{console.log("WEBSOCKET: running desired function..."),console.log(t),e[t](o)})},[x,v,w,E,C,D]),l.Object3D.DEFAULT_UP=new l.Vector3(0,0,1),(0,s.jsxs)("div",{className:n().visContainer,children:[(0,s.jsx)(U,{isOpen:S,children:(0,s.jsx)(z,{})}),(0,s.jsxs)(a.Xz,{gl:{antialias:!0,preserveDrawingBuffer:!0},id:"threeCanvas",children:[(0,s.jsx)(Y,{}),(0,s.jsx)(H,{}),(0,s.jsx)(m,{t:[1,1,1]}),(0,s.jsx)("hemisphereLight",{groundColor:new l.Color(1118498)}),(0,s.jsx)(h,{x:10,y:10,z:10,color:16777215,intensity:.2}),(0,s.jsx)(h,{x:-10,y:-10,z:10,color:16777215,intensity:.2}),(0,s.jsx)(c.z,{panSpeed:.5,rotateSpeed:.4}),(0,s.jsx)("axesHelper",{args:[100]}),(0,s.jsx)(j,{}),(0,s.jsx)(i.Suspense,{fallback:null,children:(0,s.jsx)(R,{meshes:E})})]})]})};X.displayName="Viewer";var Z=X},2506:function(e){e.exports={container:"home_container__TLSt1",main:"home_main__C5E0Z"}},1472:function(e){e.exports={overlay_background:"overlay_overlay_background__qcqTT",overlay_container:"overlay_overlay_container__qRGGS"}},9449:function(e){e.exports={visContainer:"vis_visContainer__9c9Sa"}}},function(e){e.O(0,[471,689,319,776,971,23,744],function(){return e(e.s=8307)}),_N_E=e.O()}]);